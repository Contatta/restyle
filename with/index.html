<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8' />
    <meta name="description" content="Restyle : with" />
    <title>with(restyle.properties)</title>
    <script src="/test/build/restyle.js"></script>
    <script src="/test/build/restyle.properties.js"></script>
    <script src="/javascripts/cssbeautify.js"></script>
    <script>
    with(restyle.properties) {
      restyle({
        'html, body, div, textarea, pre': {
          overflowX: hidden,
          fontSize: 14,
          lineHeight: 16,
          fontFamily: 'monospace',
          padding: 0,
          margin: 0,
          border: none,
          width: '100%',
          height: '100%'
        },
        'div > div': {
          padding: '1%',
          height: '98%'
        },
        'body > div:nth-child(2)': {
          backgroundColor: '#EEE'
        },
        'body > div': {
          width: '50%',
          float: left
        }
      });
    }
    this.onload = function () {
      /*@cc_on // @source https://gist.github.com/WebReflection/7286687
      (function(f){
       window.setTimeout =f(window.setTimeout);
       window.setInterval =f(window.setInterval);
      })(function(f){return function(c,t){var a=[].slice.call(arguments,2);return f(function(){c.apply(this,a)},t)}});
      @*/
      var Delayed=function(e){function d(){Infinity===this.waiting&&0===this.waiting||clearTimeout(this.waiting);this.waiting=0}function f(c,b,a,d){c.waiting=0;b.apply(a,d)}function c(e,b){function a(){d.call(a);a.waiting=setTimeout(f,b,a,e,this,arguments)}b||(b=c.delay);a.clear=d;a.waiting=Infinity;return a}c.delay=e;return c}(500);
      var
        textarea = document.getElementsByTagName('textarea')[0],
        pre = document.getElementsByTagName('pre')[0],
        textContent = 'textContent' in pre ? 'textContent' : 'innerText'
      ;
      textarea.onkeyup = Delayed(function () {
        var value = textarea.value.replace(/^\s+|\s+$/g, ''),
            style;
        if (value.length) {
          try {
            style = Function('r','with(r.properties)return r(' + value + ',[])')(restyle);
            value = style.valueOf();
            style.remove();
            pre[textContent] = cssbeautify(value, {
              indent: '  ',
              openbrace: 'end-of-line',
              autosemicolon: false
            });
          } catch(o_O){}
        }
      });
      textarea.onkeyup.call(textarea);
    };
    </script>
  </head>
  <body>
    <div><div><textarea autofocus>{
  'html, body': {
    overflow: hidden,
    padding: 0,
    margin: 0
  }
}</textarea></div></div>
    <div><div><pre></pre></div></div>
  </body>
</html>
